{% extends 'ProfilUtilisateur/base.html' %}

{% block title %}Profil de {{ utilisateur.username }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <!-- Image de couverture -->
  <!-- Section Profil Principal -->
  <div class="card shadow-lg rounded">
    <div class="card-header bg-primary text-white text-center">
      <h2>{{ utilisateur.username }}</h2>
      <p class="mb-0">{{ utilisateur.bio|default:"Aucune biographie ajoutée" }}</p>
    </div>
    <div class="card-body">
      <div class="row align-items-center">
        <!-- Image de profil -->
        <div class="col-md-3 text-center">
          {% if utilisateur.image %}
          <img src="{{ utilisateur.image.url }}" alt="Image de profil" class="rounded-circle img-thumbnail shadow"
               style="width: 180px; height: 180px; object-fit: cover;">
          {% else %}
          <div class="rounded-circle bg-light border d-flex align-items-center justify-content-center"
               style="width: 180px; height: 180px;">
            <p class="text-muted">Pas d'image</p>
          </div>
          {% endif %}
        </div>
        <!-- Informations principales -->
        <div class="col-md-9">
          <h5 class="text-primary">Informations Personnelles</h5>
          <p><strong>Prénom :</strong> {{ utilisateur.first_name }}</p>
          <p><strong>Nom :</strong> {{ utilisateur.last_name }}</p>
          <p><strong>Email :</strong> {{ utilisateur.email }}</p>
          <p><strong>Téléphone :</strong> {{ utilisateur.telephone }}</p>
          <p><strong>Date de naissance :</strong> {{ utilisateur.date_naissance }}</p>
          <p><strong>Adresse :</strong> {{ utilisateur.adresse }}</p>
          <p><strong>Genre :</strong> {{ utilisateur.get_genre_display }}</p>
        </div>
      </div>
    </div>
    <div class="card-footer text-center">
      {% if user.is_authenticated and user.is_superuser and user != utilisateur %}
        <button id="copy-info-btn" class="btn btn-info">Copier les infos</button>
      {% else %}
        <a href="{% url 'user_list' %}" class="btn btn-secondary">Retour à la Liste</a>
      {% endif %}
    </div>
  </div>

  <!-- Section Informations Supplémentaires -->
  <div class="card shadow-lg rounded mt-4">
    <div class="card-body text-center">
      <h5 class="text-primary">Informations Supplémentaires</h5>
      <p><strong>Date d'inscription :</strong> {{ utilisateur.date_joined|date:"d M Y" }}</p>
      <p><strong>Dernière connexion :</strong> {{ utilisateur.last_login|date:"d M Y H:i" }}</p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  (function () {
    var btn = document.getElementById('copy-info-btn');
    if (!btn) return;
    btn.addEventListener('click', function () {
      // Gather info from the page
      var lines = [];
      lines.push('Username: ' + '{{ utilisateur.username }}');
      lines.push('Prénom: ' + '{{ utilisateur.first_name }}');
      lines.push('Nom: ' + '{{ utilisateur.last_name }}');
      lines.push('Email: ' + '{{ utilisateur.email }}');
      lines.push('Téléphone: ' + '{{ utilisateur.telephone }}');
      lines.push('Adresse: ' + '{{ utilisateur.adresse }}');
      lines.push('Date d\'inscription: ' + '{{ utilisateur.date_joined|date:"d M Y" }}');
      var text = lines.join('\n');
      // copy to clipboard
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function () {
          showToast('Infos copiées dans le presse-papiers');
        }).catch(function (err) {
          console.error('Erreur de copie:', err);
          showToast('Erreur lors de la copie');
        });
      } else {
        // Fallback
        var ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); showToast('Infos copiées dans le presse-papiers'); }
        catch (e) { showToast('Erreur lors de la copie'); }
        document.body.removeChild(ta);
      }
    });

    function showToast(msg) {
      var t = document.getElementById('copy-toast');
      if (!t) return alert(msg);
      t.innerText = msg;
      t.classList.add('show');
      setTimeout(function () { t.classList.remove('show'); }, 2200);
    }
  })();
</script>

<style>
  /* small toast */
  #copy-toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background:#343a40; color:#fff; padding:8px 12px; border-radius:6px; opacity:0; transition:opacity .18s ease; z-index:1200; }
  #copy-toast.show { opacity: 0.95; }
</style>

<div id="copy-toast" aria-hidden="true" role="status" style="display:block;">&nbsp;</div>
{% endblock %}